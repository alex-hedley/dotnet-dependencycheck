on: 
  workflow_dispatch:
#   push:
#     branches: [ main, dev ]
#     paths: src/**
#   pull_request:
#     branches: [ main ]
#     paths: src/**

# # Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
# permissions:
#   contents: read
#   pages: write
#   id-token: write

jobs:
  depcheck:
    runs-on: ubuntu-latest
    name: OWASP Dependency-Check
    
    steps:
      - name: ðŸ›Žï¸ Checkout
        uses: actions/checkout@v3
        
      - name: âš™ï¸ Setup .NET 7.0
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0.x'
          # include-prerelease: true

      - name: â¬‡ï¸ Restore dependencies
        run: dotnet restore
        working-directory: src
        
      - name: ðŸ”¨ Build
        run: dotnet build --no-restore
        working-directory: src

      # - name: Unit Testing
      #   run: dotnet test --collect:"XPlat Code Coverage"
      #   working-directory: src

      # - name: Publish Test Results
      #   uses: EnricoMi/publish-unit-test-result-action@v2
      #   if: always()
      #   with:
      #     xunit_files: 'src/**/TestResults/**/coverage.cobertura.xml'
      
      - name: Depcheck
        uses: dependency-check/Dependency-Check_Action@main
        id: Depcheck
        with:
          project: 'test'
          path: './src'
          format: 'HTML'
          out: 'reports' # this is the default, no need to specify unless you wish to override it
          args: >
            --failOnCVSS 7
            --enableRetired
      
      - name: Upload Test results
        uses: actions/upload-artifact@v3
        with:
           name: Depcheck report
           path: ${{github.workspace}}/reports

      - name: Commit wwwroot to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4.4.3
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages
          FOLDER: ${{github.workspace}}/reports
